$.fn.menu=function(e,t){var n=$.type(e);if("string"===n)return this.each(function(){var n=$(this).data("ui");if(!n||!n.iMenu)throw new Error("UI:menu does not init...");n.iMenu[e](t)}),!0;var i=$.extend(!0,{animate:{time:0},autoHide:!0,data:[]},e),s=function(e,t){return new s.prototype.init(e,t)};return s.prototype={init:function(e,t){var n=this;this.userOptions=t;var i=window.document,s=$(e);s.addClass("menu-ctn cf").hide(),this.container=e,this.menuitems={};var a=function(e){var t=e.data,s=i.createElement("div");s.className="wraper",e.width&&(5===i.documentMode||/MSIE 6/.test(navigator.userAgent)?s.style.width=e.width+2+"px":s.style.width=e.width+"px"),s.style.position="relative";var o=i.createElement("ul");o.className="cf";for(var u=0,r=t.length-1;u<=r;u++){var l,h=i.createElement("li");if("separate"==t[u]["class"])l=i.createElement("span"),h.className=t[u]["class"];else{l=i.createElement("a");var d=i.createElement("span"),m=i.createElement("span");if(t[u].sub&&t[u].sub.data&&t[u].sub.data.length){var c=i.createElement("span");c.className="sub-tag",l.appendChild(c)}d.className="icon"+(t[u].icon?" icon-"+t[u].icon:""),l.appendChild(d),m.innerHTML=t[u].text||"",m.className="text",l.appendChild(m),l.setAttribute("href","javascript:;"),t[u].disabled&&(l.className="disabled"),t[u]["class"]&&(h.className=t[u]["class"]),n.menuitems[t[u].name]=h}if(l.option=t[u],h.appendChild(l),t[u].sub&&t[u].sub.data&&t[u].sub.data.length){var p=i.createElement("div");p.style.display="none",5===i.documentMode||/MSIE 6/.test(navigator.userAgent)?(p.style.position="absolute",p.style.marginTop="-22px"):(p.style.position="relative",p.style.top="-22px"),p.style.left=e.width-2+"px",p.appendChild(a(t[u].sub)),p.className="menu-ctn cf",h.appendChild(p)}o.appendChild(h)}return s.appendChild(o),s};$(a(t)).appendTo(e),s.on({mouseenter:function(){this.showMenuTimer&&clearTimeout(this.showMenuTimer),this.showMenuTimer=null},mouseleave:function(){var e=this;this.showMenuTimer=setTimeout(function(){e.style.display="none",e.showMenuTimer=null,n.hide()},300)}}).on({click:function(){return!this.option.disabled&&(e.style.display="none",void n.userOptions.onClick.bind(this)(this.option))},mouseenter:function(){if(this.option.disabled)return!0;var e=this.nextSibling;e&&(e.showMenuTimer&&clearTimeout(e.showMenuTimer),e.showMenu=!0,e.style.display="",e.showMenuTimer=null)},mouseleave:function(){var e=this.nextSibling;e&&e.showMenu===!0&&(e.showMenuTimer=setTimeout(function(){e.showMenu=!1,e.style.display="none",e.showMenuTimer=null},300))}},"a").on({mouseover:function(){this.showMenuTimer&&clearTimeout(this.showMenuTimer),this.showMenu=!0,this.showMenuTimer=null},mouseout:function(){var e=this;this.showMenuTimer=setTimeout(function(){e.showMenu=!1,e.style.display="none",e.showMenuTimer=null},300)}},".menu-ctn"),t.onCreate.bind(this)()},open:function(e){this.show(e)},show:function(e){return $(this.container).css({left:e.pageX,top:e.pageY}).show(),this.userOptions.onShow.bind(this)(),this},hide:function(){return $(this.container).hide(),this.userOptions.onHide.bind(this)(),this},hideMenuItem:function(e){return this.menuitems[e].style.display="none",this},showMenuItem:function(e){return this.menuitems[e].style.display="",this},addMenuItem:function(e,t,n){var i,s=document.createElement("li");if("separate"==e["class"])i=document.createElement("span"),s.className=e["class"];else{i=document.createElement("a");var a=document.createElement("span"),o=document.createElement("span");a.className="icon"+(e.icon?" icon-"+e.icon:""),i.appendChild(a),o.innerHTML=e.text||"",o.className="text",i.appendChild(o),i.setAttribute("href","javascript:;"),i.option=e,e.disabled&&(i.className="disabled"),e["class"]&&(s.className=e["class"]),this.menuitems[e.name]=s}s.appendChild(i);var u,r;return n?(u=$(this.menuitems[n]),t||(t="after"),r=t):(u=$("ul",this.container).eq(0),r=t&&"after"!=t?"prepend":"append"),u[r](s),this},updateMenuItem:function(e,t){if(!this.menuitems[e])return this;var n=$(this.menuitems[e]);return n.find("a")[t.disabled?"addClass":"removeClass"]("disabled").get(0).option=t,n.find(".icon").removeClass().addClass("icon"+(t.icon?" icon-"+t.icon:"")),n.find(".text").html(t.text),this},deleteMenuItem:function(e){return this.menuitems[e]?(this.menuitems[e].option=null,$(this.menuitems[e]).remove(),this):this}},s.prototype.init.prototype=s.prototype,this.each(function(){var e=$(this),t=s(this,$.extend(!0,{},i)),n=e.data("ui");n?n.iMenu=t:e.data("ui",{iMenu:t})})};