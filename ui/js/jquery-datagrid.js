!function(){"use strict";for(var t=["webkit","moz"],e=0;e<t.length&&!window.requestAnimationFrame;++e){var r=t[e];window.requestAnimationFrame=window[r+"RequestAnimationFrame"],window.cancelAnimationFrame=window[r+"CancelAnimationFrame"]||window[r+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var n=0;window.requestAnimationFrame=function(t){var e=Date.now(),r=Math.max(n+16,e);return setTimeout(function(){t(n=r)},r-e)},window.cancelAnimationFrame=clearTimeout}}(),Function.prototype.bind=Function.prototype.bind||function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),r=this,n=function(){},i=function(){return r.apply(this instanceof n&&t?this:t||window,e.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,i.prototype=new n,i},Array.prototype.forEach=Array.prototype.forEach||function(t,e){for(var r=0,n=this.length;r<n;++r)r in this&&t.call(e,this[r],r,this)},Array.prototype.indexOf=Array.prototype.indexOf||function(t,e){var r=-1;e=1*e||0;for(var n=0,i=this.length;n<i;n++)if(n>=e&&this[n]===t){r=n;break}return r},Array.prototype.map=Array.prototype.map||function(t,e){var r=[];if("function"==typeof t)for(var n=0,i=this.length;n<i;n++)r.push(t.call(e,this[n],n,this));return r},Array.prototype.filter=Array.prototype.filter||function(t,e){var r=[];if("function"==typeof t)for(var n=0,i=this.length;n<i;n++)t.call(e,this[n],n,this)&&r.push(this[n]);return r},$.fn.datagrid=function(t){function e(t){var r="",n=[],i=null,a=null,o=e,l=d(t);if("array"===l)for(var s in t)r+=o(t[s]);else if("string"===l||"number"==l)r=t;else if("object"===l&&t.name){if(i=t.attr,a=t.children,n=[],i)for(var c in i){if("style"==c){var u=i[c],h=d(u);if(i[c]="","object"==h)for(var f in u)i[c]+=f+":"+u[f]+";";else"string"==h&&(i[c]=u)}n.push(""+c+'="'+i[c]+'"')}n.length&&n.unshift(""),a&&"array"!==d(a)&&(a=[a]),r="<"+t.name+n.join(" ")+">"+(a?o(a):"")+"</"+t.name+">"}else r="";return r}function r(t,r){function n(n,i){if(!n||i&&!t.frozenColumns.length)return[];var a=i?"frozenColumns":"columns",o=n.length-1;return n.map(function(n,l){return e({name:"tr",children:function(){var s=n.map(function(n){var i=n.name||n.field||"",s=t.autoColWidth||n.colspan?"auto":(n.width||t.colWidth)+"px",d={};n.rowspan&&(d.rowspan=n.rowspan),n.colspan&&(d.colspan=n.colspan);var c=n.colspan||1,u=1==c&&(l==o||o+1==l+(n.rowspan||1)),h={"class":"cell",style:{width:s}};if(u){r[a].push(n);var f=["field"];(t.sortable&&n.sortable!==!1||1==n.sortable)&&f.push("sortable"),d["class"]=f.join(" "),h["data-field"]=n.field}return e({name:"td",attr:d,children:{name:"div",attr:{"class":"cell-wrapper"},children:{name:"div",attr:h,children:[" ",{name:"span",attr:{"class":"field-title"},children:i},{name:"span",attr:{"class":"sort-mark"}}," "]}}})});return(t.frozenColumns.length&&i&&0===l&&t.rowNum||!t.frozenColumns.length&&0===l&&t.rowNum)&&s.unshift(e({name:"td",attr:{rowspan:t.frozenColumns.length||t.columns.length,"class":"field"},children:{name:"div",attr:{"class":"cell-wrapper"},children:{name:"div",attr:{"class":"cell"}}}})),s}()})})}function i(r,n,i){return i&&!t.frozenColumns.length?[]:r.map(function(r,a){return e({name:"tr",children:function(){var o=[];return(t.frozenColumns.length&&i&&t.rowNum||!t.frozenColumns.length&&t.rowNum)&&o.push(e({name:"td",children:{name:"div",attr:{"class":"cell-wrapper"},children:{name:"div",attr:{"class":"cell"},children:a+t.startRowNum}}})),n&&n.forEach(function(n){if(!n)return!0;var i=n.field,a=r[i],l=n.formatter,s=["cell"],d={left:"txt-lt",right:"txt-rt"}[n.align]||"";d&&s.push(d),o.push(e({name:"td",children:{name:"div",attr:{"class":"cell-wrapper"},children:{name:"div",attr:{"class":s.join(" "),style:{width:t.autoColWidth?"auto":(n.width||t.colWidth)+"px"}},children:"function"===$.type(l)?l(a,r,i):a}}}))}),o}()})})}return e({name:"div",attr:{"class":"view-wrapper grid"+(t.autoRowHeight?" autoRowHeight":"")},children:[{name:"div",attr:{"class":"col col-view frozen-view"},children:[{name:"div",attr:{"class":"head-wrapper"},children:{name:"table",attr:{"class":"frozen head"},children:{name:"tbody",children:n(t.frozenColumns,!0)}}},{name:"div",attr:{"class":"body-wrapper"},children:{name:"table",attr:{"class":"frozen body"},children:{name:"tbody",children:i(t.data,r.frozenColumns,!0)}}}]},{name:"div",attr:{"class":"col-rest col-view auto-view"},children:[{name:"div",children:[{name:"div",attr:{style:"overflow:hidden"},children:{name:"div",attr:{"class":"head-wrapper"},children:{name:"table",attr:{"class":"head"},children:{name:"tbody",children:n(t.columns)}}}},{name:"div",attr:{"class":"body-wrapper"},children:{name:"table",attr:{"class":"body"},children:{name:"tbody",children:i(t.data,r.columns)}}}]}]}]})}var n=$.type(t);if("string"===n){var i=Array.prototype.slice.call(arguments).slice(1),a=[];this.each(function(e,r){var n=$(r).data("ui");if(!n||!n.iDatagrid)throw new Error("UI:datagrid does not init...");a.push(n.iDatagrid[t].apply(n.iDatagrid,i))});var o=a.length;return 0===o?this:1===o?a[0]:a}t=$.extend(!0,{align:"center",colWidth:80,rowNum:!1,startRowNum:1,triggerRow:!1,data:[],sortable:!1,sort:null,dataType:"string",remoteSort:!1,autoRowHeight:!0,autoColWidth:!0,frozenColumns:[],columns:[]},t);var l=function(t,e){return new l.prototype.init(t,e)},s=Object.prototype.toString,d=function(t){return s.call(t).slice(8,-1).toLowerCase()},c=function(t,e){return t["offset"+("width"===e?"Width":"Height")]},u=function(t,e,r){for(var n="offset"+("width"===r?"Width":"Height"),i=0;i<t.length;i++){var a=t[i][n],o=e[i][n],l=a<o?o:a;t[i].style[r]=e[i].style[r]=l+"px"}},h=function(t,e,r){for(var n=0;n<t.length;n++){var i=r[n],a=c(t[n],e),o=c(i,e);if(a!==o){var l=a<o?o:a;t[n].style[e]=i.style[e]=l+6+"px"}}},f=function(t,e){function r(){n.get(0).parentNode.scrollLeft=this.scrollLeft,t.get(1).parentNode.scrollTop=this.scrollTop}if(t.length<4)return!1;var n=t.eq(2).parent(),i=t.eq(3).parent();$([n.get(0),i.get(0)]).css({width:5e5});var a=e.userOptions;h(t.filter("table:odd").find("tr:first-child td .cell").toArray(),"width",e.fieldElements.toArray()),(a.rowNum||a.frozenColumns)&&(a.autoRowHeight&&h($("table:eq(1) td:first-child",e.render).toArray(),"height",$("table:eq(3) td:first-child",e.render).toArray()),u([t[0],t[1]],[t[2],t[3]],"height"),u([t[0],t[2]],[t[1],t[3]],"width"));var o="auto";i.css({width:o}),n.parent().css({width:o,overflow:"hidden"}),$(i).off("scroll").on("scroll",function(){this._scroll_id&&(cancelAnimationFrame(this._scroll_id),this._scroll_id=null),this._scroll_id=requestAnimationFrame(r.bind(this))}),$(t.eq(1)).off("mousewheel DOMMouseScroll").on("mousewheel DOMMouseScroll",function(e){var r=t.get(3).parentNode;return r.scrollTop-=(e.originalEvent.wheelDelta||120*-(e.originalEvent.detail/3))/3,t.get(1).parentNode.scrollTop=r.scrollTop,!1})};return l.prototype={defaultOrder:!1,init:function(t,e){$(t).addClass("datagrid-ctn"),this.render=t,this.init_event(e),this.update(e),e.onCreate.bind(this)()},update:function(t){var e=this,n=this.render,i=this.userOptions;if(i){var a=i.data;(a[0].tr||a[0].frozenTr)&&a.forEach(function(t){delete t.tr,i.frozenColumns.length&&delete t.frozenTr}),t.data&&(this.userOptions.data=t.data),delete t.data,t=$.extend(!0,{},this.userOptions,t)}a=t.data,$(n).empty(),this.columns=[],this.frozenColumns=[],this.userOptions=t,$(r(t,e)).prependTo(n),this.fieldElements=$(".field .cell",n),this.allColumns=[].concat(this.frozenColumns,this.columns),this.dataTbodys=$(".body tbody",n),a.forEach(function(r,n){t.frozenColumns.length&&(r.frozenTr=e.dataTbodys[0].rows[n]),r.tr=e.dataTbodys[1].rows[n]}),t.data=a,a=null;var o=t.sort;if(t.remoteSort){var l=~[!0,"desc"].indexOf(o.order)?"desc":"asc";$(".head-wrapper [data-field="+o.field+"] .sort-mark",n).addClass(l)}else o&&this.sortBy({field:o.field,order:o.order});return this.reAlign(),this},reAlign:function(){f($("table",this.render),this);var t=/MSIE (\d+)\.?/.exec(navigator.userAgent);return t&&t.length&&t[1]&&(t=Number(t[1]),t<8&&$(".auto-view",this.render).css({width:"auto","margin-left":$(".frozen-view",this.render).get(0).offsetWidth}).find(".body-wrapper").css({"margin-top":"-2px"})),this},init_event:function(t){var e=this,r=$(this.render);t.remoteSort||r.on("click",".field.sortable",function(){var t=$(".cell",this).get(0);e.sortBy({field:$(t).data("field"),order:!t.order||e.defaultOrder},t)}),t.triggerRow&&r.on({mouseenter:function(){var t=e.relatedData;t&&t.tr&&t.tr.parentNode&&$([t.frozenTr,t.tr]).removeClass("hover"),e.relatedData=t=e.userOptions.data[this.rowIndex];var r;this===t.frozenTr&&t.tr?r=t.tr:t.frozenTr&&(r=t.frozenTr),$(r).addClass("hover")},mouseleave:function(){var t=e.relatedData;t&&$([t.frozenTr,t.tr]).removeClass("hover"),e.relatedData=null}},".body-wrapper tr")},sortType:{string:function(t,e){var r=this.field,n=t[r],i=e[r];return n==i?0:n>i?1:-1},number:function(t,e){var r=this.field;return t[r]-e[r]}},getFieldOption:function(t){return this.allColumns.filter(function(e){return e.field===t})[0]},getColumnSortFunction:function(t){var e=this.getFieldOption(t.field);if(!e)return console.log(t,"Field not found......");var r=e.dataType||this.userOptions.dataType||"string",n=e.sort||this.sortType[r];return function(e,r){return n.call(t,e,r)*(t.order?-1:1)}},sortBy:function(t,e){var r=this.userOptions,n=this.sortElement;if(t.order=!!~[!0,"desc"].indexOf(t.order),this.sortElement=e=e||$(".head-wrapper [data-field="+t.field+"]",this.render).get(0),n){if(e===n){if(t.order===n.order)return this;r.data=r.data.reverse()}$(".sort-mark",n).removeClass("asc desc")}return $(".sort-mark",e).addClass(t.order?"desc":"asc"),r.data.sort(this.getColumnSortFunction(t)),e.order=t.order,e.field=t.field,this.sort_table_dom(r)},sort_table_dom:function(t){var e=document.createDocumentFragment(),r=document.createDocumentFragment(),n=null,i=null;return t.data.forEach(function(a,o){var l=a.frozenTr,s=a.tr;l&&(n||function(){n=l.parentNode,n.style.display="none"}(),e.appendChild(l),t.rowNum&&$("td:eq(0) .cell",l).text(o+1)),s&&(i||function(){i=s.parentNode,i.style.display="none"}(),r.appendChild(s),!l&&t.rowNum&&$("td:eq(0) .cell",s).text(o+1))}),n&&(e.children||e.childNodes)&&(n.appendChild(e),n.style.display=""),i&&(r.children||r.childNodes)&&(i.appendChild(r),i.style.display=""),e=null,r=null,n=null,i=null,this}},l.prototype.init.prototype=l.prototype,this.each(function(){var e=$(this),r=l(this,$.extend(!0,{},t)),n=e.data("ui");n?n.iDatagrid=r:e.data("ui",{iDatagrid:r})})};