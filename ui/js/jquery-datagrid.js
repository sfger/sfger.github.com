!function(){"use strict";for(var t=["webkit","moz"],e=0;e<t.length&&!window.requestAnimationFrame;++e){var r=t[e];window.requestAnimationFrame=window[r+"RequestAnimationFrame"],window.cancelAnimationFrame=window[r+"CancelAnimationFrame"]||window[r+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var n=0;window.requestAnimationFrame=function(t){var e=Date.now(),r=Math.max(n+16,e);return setTimeout(function(){t(n=r)},r-e)},window.cancelAnimationFrame=clearTimeout}}(),$.fn.datagrid=function(t){var e=$.type(t);if("string"===e){var r=Array.prototype.slice.call(arguments).slice(1),n=[];this.each(function(e,i){var a=$(i).data("ui");if(!a||!a.iDatagrid)throw new Error("UI:datagrid does not init...");n.push(a.iDatagrid[t].apply(a.iDatagrid,r))});var i=n.length;return 0===i?this:1===i?n[0]:n}t=$.extend(!0,{rowNum:!1,colWidth:80,startRowNum:1,data:[],sortable:!0,sort:null,dataType:"string",remoteSort:!1,autoRowHeight:!0,autoColWidth:!0,frozenColumns:[],columns:[]},t);var a=function(t,e){return new a.prototype.init(t,e)},o=Object.prototype.toString,l=function(t){return o.call(t).slice(8,-1).toLowerCase()},s=function(t){var e="",r=[],n=null,i=null,a=s,o=l(t);if("array"===o)for(var d in t)e+=a(t[d]);else if("string"===o||"number"==o)e=t;else if("object"===o&&t.name){if(n=t.attr,i=t.children,r=[],n)for(var c in n){if("style"==c){var u=n[c],h=l(u);if(n[c]="","object"==h)for(var f in u)n[c]+=f+":"+u[f]+";";else"string"==h&&(n[c]=u)}r.push(""+c+'="'+n[c]+'"')}r.length&&r.unshift(""),i&&"array"!==l(i)&&(i=[i]),e="<"+t.name+r.join(" ")+">"+(i?a(i):"")+"</"+t.name+">"}else e="";return e},d=function(t,e){var r=function(r,n){if(!r||n&&!t.frozenColumns.length)return[];var i=n?"frozenColumns":"columns",a=r.length-1;return r.map(function(r,o){return s({name:"tr",children:function(){var l=r.map(function(r){var n=r.name||r.field||"",l=t.autoColWidth||r.colspan?"auto":(r.width||t.colWidth)+"px",d={};r.rowspan&&(d.rowspan=r.rowspan),r.colspan&&(d.colspan=r.colspan);var c=r.colspan||1,u=1==c&&(o==a||a+1==o+(r.rowspan||1)),h={"class":"cell",style:{width:l}};if(u){e[i].push(r);var f=["field"];(t.sortable&&r.sortable!==!1||1==r.sortable)&&f.push("sortable"),d["class"]=f.join(" "),h["data-field"]=r.field}return s({name:"td",attr:d,children:{name:"div",attr:{"class":"cell-wrapper"},children:{name:"div",attr:h,children:[" ",{name:"span",attr:{"class":"field-title"},children:n},{name:"span",attr:{"class":"sort-mark"}}," "]}}})});return(t.frozenColumns.length&&n&&0===o&&t.rowNum||!t.frozenColumns.length&&0===o&&t.rowNum)&&l.unshift(s({name:"td",attr:{rowspan:t.frozenColumns.length||t.columns.length,"class":"field"},children:{name:"div",attr:{"class":"cell-wrapper"},children:{name:"div",attr:{"class":"cell"}}}})),l}()})})},n=function(e,r,n){return n&&!t.frozenColumns.length?[]:e.map(function(e,i){return s({name:"tr",children:function(){var a=[];return t.frozenColumns.length&&n&&t.rowNum&&a.push(s({name:"td",children:{name:"div",attr:{"class":"cell-wrapper"},children:{name:"div",attr:{"class":"cell"},children:i+t.startRowNum}}})),r&&r.forEach(function(r){if(!r)return!0;var n=r.field,i=e[n],o=r.formatter,l=["cell"],d={left:"txt-lt",right:"txt-rt"}[r.align]||"";d&&l.push(d),a.push(s({name:"td",children:{name:"div",attr:{"class":"cell-wrapper"},children:{name:"div",attr:{"class":l.join(" "),style:{width:t.autoColWidth?"auto":(r.width||t.colWidth)+"px"}},children:"function"===$.type(o)?o(i,e,n):i}}}))}),a}()})})};return s({name:"div",attr:{"class":"view-wrapper grid"+(t.autoRowHeight?" autoRowHeight":"")},children:[{name:"div",attr:{"class":"col col-view frozen-view"},children:[{name:"div",attr:{"class":"head-wrapper"},children:{name:"table",attr:{"class":"frozen head"},children:{name:"tbody",children:r(t.frozenColumns,!0)}}},{name:"div",attr:{"class":"body-wrapper"},children:{name:"table",attr:{"class":"frozen body"},children:{name:"tbody",children:n(t.data,e.frozenColumns,!0)}}}]},{name:"div",attr:{"class":"col-rest col-view auto-view"},children:[{name:"div",children:[{name:"div",attr:{style:"overflow:hidden"},children:{name:"div",attr:{"class":"head-wrapper"},children:{name:"table",attr:{"class":"head"},children:{name:"tbody",children:r(t.columns)}}}},{name:"div",attr:{"class":"body-wrapper"},children:{name:"table",attr:{"class":"body"},children:{name:"tbody",children:n(t.data,e.columns)}}}]}]}]})},c=function(t,e){return t["offset"+("width"===e?"Width":"Height")]},u=function(t,e,r){var n="offset"+("width"===r?"Width":"Height");$(t).each(function(t){var i=this[n],a=e[t][n],o=i<a?a:i;this.style[r]=e[t].style[r]=o+"px"})},h=function(t,e,r){$.each(t,function(t){var n=r[t],i=c(this,e),a=c(n,e);if(i!==a){var o=i<a?a:i;this.style[e]=n.style[e]=o+3+"px"}})},f=function(t,e){if(4==t.length){var r=t.eq(2).parent(),n=t.eq(3).parent();r.css({width:5e5}),n.css({width:5e5});var i=e.userOptions;h(t.filter("table:odd").find("tr:first-child td .cell"),"width",e.fieldElements),(i.rowNum||i.frozenColumns)&&(i.autoRowHeight&&h($("table:eq(1) td:first-child"),"height",$("table:eq(3) td:first-child")),u($([t[0],t[1]]),$([t[2],t[3]]),"height"),u($([t[0],t[2]]),$([t[1],t[3]]),"width"));var a="auto";n.css({width:a}),r.parent().css({width:a,overflow:"hidden"});var o=function(){r.get(0).parentNode.scrollLeft=this.scrollLeft,t.get(1).parentNode.scrollTop=this.scrollTop};$(n).off("scroll").on("scroll",function(){this._scroll_id&&cancelAnimationFrame(this._scroll_id),this._scroll_id=requestAnimationFrame(o.bind(this))})}};return a.prototype={defaultOrder:!1,init:function(t,e){$(t).addClass("datagrid-ctn"),this.render=t,this.init_event(e),this.update(e),e.onCreate.bind(this)()},update:function(t){var e=this,r=this.render,n=t.data;t=$.extend(!0,{},this.userOptions,t),(n[0].tr||n[0].frozenTr)&&n.forEach(function(e){e.tr=null,t.frozenColumns.length&&(e.frozenTr=null)}),$(r).empty(),this.columns=[],this.frozenColumns=[],this.userOptions=t,$(d(t,e)).prependTo(r),this.fieldElements=$(".field .cell",r),this.allColumns=[].concat(this.frozenColumns,this.columns),this.dataTbodys=$(".body tbody",r),n.forEach(function(r,n){t.frozenColumns.length&&(r.frozenTr=e.dataTbodys[0].rows[n]),r.tr=e.dataTbodys[1].rows[n]}),t.data=n,n=null;var i=t.sort;if(t.remoteSort){var a=~[!0,"desc"].indexOf(i.order)?"desc":"asc";$(".head-wrapper [data-field="+i.field+"] .sort-mark",r).addClass(a)}else i&&this.sortBy({field:i.field,order:i.order});return this.reAlign(),this},reAlign:function(){return f($("table",this.render),this),this},resize:function(){return this},init_event:function(t){var e=this,r=$(this.render);t.remoteSort||r.on("click",".field.sortable",function(){var t=$(".cell",this).get(0);e.sortBy({field:$(t).data("field"),order:!t.order||e.defaultOrder},t)})},sortType:{string:function(t,e){var r=this.field,n=t[r],i=e[r];return n==i?0:n>i?1:-1},number:function(t,e){var r=this.field;return t[r]-e[r]}},getFieldOption:function(t){return this.allColumns.filter(function(e){return e.field===t})[0]},getColumnSortFunction:function(t){var e=this.getFieldOption(t.field),r=e.dataType||this.userOptions.dataType||"string",n=e.sort||this.sortType[r];return function(e,r){return n.call(t,e,r)*(t.order?-1:1)}},sortBy:function(t,e){var r=this.userOptions,n=this.sortElement;if(t.order=!!~[!0,"desc"].indexOf(t.order),this.sortElement=e=e||$(".head-wrapper [data-field="+t.field+"]",this.render).get(0),n){if(e===n){if(t.order===n.order)return this;r.data=r.data.reverse()}$(".sort-mark",n).removeClass("asc desc")}return $(".sort-mark",e).addClass(t.order?"desc":"asc"),r.data.sort(this.getColumnSortFunction(t)),e.order=t.order,e.field=t.field,this.sort_table_dom(r)},sort_table_dom:function(t){var e=document.createDocumentFragment(),r=document.createDocumentFragment(),n=null,i=null;return t.data.forEach(function(a,o){var l=a.frozenTr,s=a.tr;l&&(n||function(){n=l.parentNode,n.style.display="none"}(),e.appendChild(l),t.rowNum&&$("td:eq(0) .cell",l).text(o+1)),s&&(i||function(){i=s.parentNode,i.style.display="none"}(),r.appendChild(s))}),n&&(e.children||e.childNodes)&&(n.appendChild(e),n.style.display=""),i&&(r.children||r.childNodes)&&(i.appendChild(r),i.style.display=""),e=null,r=null,n=null,i=null,this}},a.prototype.init.prototype=a.prototype,this.each(function(){var e=$(this),r=a(this,$.extend(!0,{},t)),n=e.data("ui");n?n.iDatagrid=r:e.data("ui",{iDatagrid:r})})};