window.LArea=function(){var e=function(e){this.container,this.index=0,this.value=function(){var t=[0,0,0];if(e.value.length){var a=e.keys.id;if(e.data[0].forEach)e.data[0].forEach(function(i,r){i[a]==e.value[0]&&(t[0]=r)}),e.value[1]&&e.data[1][e.value[0]].forEach(function(i,r){i[a]==e.value[1]&&(t[1]=r)}),e.value[2]&&e.data[2][e.value[1]].forEach(function(i,r){i[a]==e.value[2]&&(t[2]=r)});else{var i,r;e.data.forEach(function(r,n){r[a]==e.value[0]&&(t[0]=n,i=r.child)}),i&&i.forEach(function(i,n){i[a]==e.value[1]&&(t[1]=n,r=i.child)}),r&&r.forEach(function(i,r){i[a]==e.value[2]&&(t[2]=r)})}}return t}(),this.init(e)};return e.prototype={init:function(e){switch(this.params=e,this.trigger=document.querySelector(e.trigger),e.valueTo&&(this.valueTo=document.querySelector(e.valueTo)),this.keys=e.keys,this.type=e.type||1,this.type){case 1:case 2:break;default:throw new Error("错误提示: 没有这种数据源类型")}this.bindEvent()},getData:function(e){var t=this;if("object"==typeof t.params.data)t.data=t.params.data,e();else{var a=new XMLHttpRequest;a.open("get",t.params.data),a.onload=function(){if(a.status>=200&&a.status<300||0===a.status){var i=JSON.parse(a.responseText);t.data=i.data,e&&e()}},a.send()}},bindEvent:function(){function e(){o.container=document.createElement("div"),o.container.className="picker-container",o.container.innerHTML='<div class="area_ctrl slideInUp"><div class="area_btn_box"><div class="area_btn larea_cancel">取消</div><div class="area_btn larea_finish">确定</div></div><div class="area_roll_mask"><div class="area_roll"><div><div class="gear area_province" data-areatype="area_province"></div><div class="area_grid"></div></div><div><div class="gear area_city" data-areatype="area_city"></div><div class="area_grid"></div></div><div><div class="gear area_county" data-areatype="area_county"></div><div class="area_grid"></div></div></div></div></div>',document.body.appendChild(o.container),t();var e=o.container.querySelector(".larea_cancel");e.addEventListener("touchstart",function(e){o.close(e)});var n=o.container.querySelector(".larea_finish");n.addEventListener("touchstart",function(e){o.finish(e)});for(var s=o.container.querySelectorAll(".area_roll>div:nth-child(n+"+(o.data.length+1)+")"),d=0,c=s.length;d<c;d++)s[d].style.display="none";var l=o.container.querySelector(".area_province"),v=o.container.querySelector(".area_city"),u=o.container.querySelector(".area_county");l.addEventListener("touchstart",a),v.addEventListener("touchstart",a),u.addEventListener("touchstart",a),l.addEventListener("touchmove",i),v.addEventListener("touchmove",i),u.addEventListener("touchmove",i),l.addEventListener("touchend",r),v.addEventListener("touchend",r),u.addEventListener("touchend",r)}function t(){switch(o.container.querySelector(".area_province").setAttribute("val",o.value[0]),o.container.querySelector(".area_city").setAttribute("val",o.value[1]),o.container.querySelector(".area_county").setAttribute("val",o.value[2]),o.type){case 1:o.setGearTooth(o.data);break;case 2:o.setGearTooth(o.data[0])}}function a(e){e.preventDefault();for(var t=e.target;!t.classList.contains("gear");)t=t.parentElement;clearInterval(t["int_"+t.id]),t["old_"+t.id]=e.targetTouches[0].screenY,t["o_t_"+t.id]=(new Date).getTime();var a=t.getAttribute("top");a?t["o_d_"+t.id]=parseFloat(a.replace(/em/g,"")):t["o_d_"+t.id]=0,t.style.webkitTransitionDuration=t.style.transitionDuration="0ms"}function i(e){e.preventDefault();for(var t=e.target;!t.classList.contains("gear");)t=t.parentElement;t["new_"+t.id]=e.targetTouches[0].screenY,t["n_t_"+t.id]=(new Date).getTime();var a=30*(t["new_"+t.id]-t["old_"+t.id])/window.innerHeight;t["pos_"+t.id]=t["o_d_"+t.id]+a,t.style["-webkit-transform"]="translate3d(0,"+t["pos_"+t.id]+"em,0)",t.setAttribute("top",t["pos_"+t.id]+"em"),e.targetTouches[0].screenY<1&&r(e)}function r(e){e.preventDefault();for(var t=e.target;!t.classList.contains("gear");)t=t.parentElement;var a=(t["new_"+t.id]-t["old_"+t.id])/(t["n_t_"+t.id]-t["o_t_"+t.id]);Math.abs(a)<=.2?t["spd_"+t.id]=a<0?-.08:.08:Math.abs(a)<=.5?t["spd_"+t.id]=a<0?-.16:.16:t["spd_"+t.id]=a/2,t["pos_"+t.id]||(t["pos_"+t.id]=0),n(t)}function n(e){function t(){e.style.webkitTransitionDuration=e.style.transitionDuration="200ms",i=!0}var a=0,i=!1;clearInterval(e["int_"+e.id]),e["int_"+e.id]=setInterval(function(){var r=e["pos_"+e.id],n=e["spd_"+e.id]*Math.exp(-.03*a);if(r+=n,Math.abs(n)>.1);else{var o=2*Math.round(r/2);r=o,t()}r>0&&(r=0,t());var d=2*-(e.dataset.len-1);if(r<d&&(r=d,t()),i){var c=Math.abs(r)/2;s(e,c),clearInterval(e["int_"+e.id])}e["pos_"+e.id]=r,e.style["-webkit-transform"]="translate3d(0,"+r+"em,0)",e.setAttribute("top",r+"em"),a++},30)}function s(e,t){if(!t)return!1;switch(t=Math.round(t),e.setAttribute("val",t),o.type){case 1:o.setGearTooth(o.data);break;case 2:switch(e.dataset.areatype){case"area_province":o.setGearTooth(o.data[0]);break;case"area_city":var a=e.childNodes[t].getAttribute("ref"),i=[],r=o.data[2];for(var n in r)if(n==a){i=r[n];break}o.index=2,o.setGearTooth(i)}}}var o=this;o.getData(function(){o.trigger.addEventListener("click",e)})},setGearTooth:function(e){var t=this,a=e||[],i=a.length,r=t.container.querySelectorAll(".gear"),n=r[t.index].getAttribute("val"),s=i-1;if(n>s&&(n=s),r[t.index].setAttribute("data-len",i),i>0){var o,d=a[n][this.keys.id];switch(t.type){case 1:o=a[n].child;break;case 2:var c=t.data[t.index+1];if(c)for(var l in c)if(l==d){o=c[l];break}}var v="";for(l=0;l<i;l++)v+="<div class='tooth'  ref='"+a[l][this.keys.id]+"'>"+a[l][this.keys.name]+"</div>";if(r[t.index].innerHTML=v,r[t.index].style["-webkit-transform"]="translate3d(0,"+2*-n+"em,0)",r[t.index].setAttribute("top",2*-n+"em"),r[t.index].setAttribute("val",n),t.index++,t.index>2)return void(t.index=0);t.setGearTooth(o)}else r[t.index].innerHTML="<div class='tooth'></div>",r[t.index].setAttribute("val",0),1==t.index&&(r[2].innerHTML="<div class='tooth'></div>",r[2].setAttribute("val",0)),t.index=0},finish:function(e){var t=this,a=t.container.querySelector(".area_province"),i=t.container.querySelector(".area_city"),r=t.container.querySelector(".area_county"),n=parseInt(a.getAttribute("val")),s=a.childNodes[n].textContent,o=a.childNodes[n].getAttribute("ref"),d=parseInt(i.getAttribute("val")),c=i.childNodes[d].textContent,l=i.childNodes[d].getAttribute("ref"),v=parseInt(r.getAttribute("val")),u=r.childNodes[v].textContent,h=r.childNodes[v].getAttribute("ref");t.trigger.value=s+(c?","+c:"")+(u?","+u:""),t.value=[n,d,v],this.valueTo&&(this.valueTo.value=o+(l?","+l:"")+(h?","+h:"")),this.params.onSelect&&this.params.onSelect.call(this,{text:t.trigger.value,value:t.valueTo.value}),t.close(e)},close:function(e){e.preventDefault();var t=this,a=new CustomEvent("input");t.trigger.dispatchEvent(a),document.body.removeChild(t.container)}},e}();