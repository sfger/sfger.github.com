!function(t,e){"use strict";t.fn.datagrid=function(e){var r=t.type(e);if("string"===r)return this.each(function(){var r=t(this).data("ui");if(!r||!r.iDatagrid)throw new Error("UI:datagrid does not init...");r.iDatagrid[e]()}),!0;e=t.extend(!0,{colWidth:80,startRowNum:1,data:[]},e);var n=function(t,e){return new n.prototype.init(t,e)},a=light.ui.markChars,i=light.util.push,o=(light.util.toString,light.util.getType),d=light.util.createElement,s=function(t,e){var r=function(r,n){var i=[],o=n?"frozenColumns":"columns";if(!r)return i;for(var s=r.length-1,l=s;l>=0;l--)i.unshift(d({name:"tr",children:function(){for(var i=[],c=r[l].length-1;c>=0;c--){var h=r[l][c],u=h.name||h.field||"",f=t.autoColWidth||h.colspan?"auto":(h.width||t.colWidth)+"px",m={};h.rowspan&&(m.rowspan=h.rowspan),h.colspan&&(m.colspan=h.colspan);var p=h.colspan||1,g=1==p&&(l==s||r.length==l+(h.rowspan||1));g&&(e[o].unshift(h),m.className="field"),i.unshift(d({name:"td",attr:m,children:{name:"div",attr:{className:"cell",style:{width:f}},children:[a.empty,u,{name:"span",attr:{className:"sort-mark"},children:a.empty}]}}))}return n&&0==l&&t.rowNum&&i.unshift(d({name:"td",attr:{rowspan:t.frozenColumns.length,className:"field"},children:{name:"div",attr:{className:"cell"}}})),i}()}));return i},n=function(e,r,n){var a=[];return e.forEach(function(e,i){a.push(d({name:"tr",children:function(){var a=[];return t.rowNum&&n&&a.push(d({name:"td",children:{name:"div",attr:{className:"cell"},children:i+t.startRowNum}})),r&&r.forEach(function(r,n){if(!r)return!0;var i=r.field,s=e[i],l=r.formatter;a.push(d({name:"td",children:{name:"div",attr:{className:"cell",style:{width:t.autoColWidth?"auto":(r.width||t.colWidth)+"px"}},children:"Function"===o(l)?l(s,e,i):s}}))}),a}()}))}),a};return d({name:"div",attr:{className:"view-wrapper"+(t.autoRowHeight?" autoRowHeight":"")},children:[{name:"div",attr:{className:"view frozen"},children:[{name:"div",attr:{className:"head-wrapper"},children:{name:"table",attr:{className:"frozen head"},children:{name:"tbody",children:r(t.frozenColumns,!0)}}},{name:"div",attr:{className:"body-wrapper",style:"overflow:hidden;"},children:{name:"table",attr:{className:"frozen body"},children:{name:"tbody",children:n(t.data,e.frozenColumns,!0)}}}]},{name:"div",attr:{className:"view"},children:[{name:"div",attr:{style:"overflow:hidden"},children:{name:"div",attr:{className:"head-wrapper"},children:{name:"table",attr:{className:"head"},children:{name:"tbody",children:r(t.columns)}}}},{name:"div",attr:{className:"body-wrapper"},children:{name:"table",attr:{className:"body"},children:{name:"tbody",children:n(t.data,e.columns)}}}]}]})},l=function(e,r){return document.documentMode<7||/MSIE 6/.test(navigator.userAgent)?e["offset"+("width"==r?"Width":"Height")]:t(e)[r]()},c=function(e,r,n){var a="width"===n?"Width":"Height";t(e).each(function(e,i){var o=this["offset"+a],d=r[e]["offset"+a],s=d>o?d:o;t([this,r[e]])[n](s)})},h=function(e,r,n){t.each(e,function(e,a){var i=n[e],o=l(this,r),d=l(i,r);d>o?t(this)[r](d):t(i)[r](o)})},u=function(e,r){if(4==e.length){var n=e.eq(2).parent(),a=e.eq(3).parent();n.css({width:5e5}),a.css({width:5e5});var i=r.userOptions;(i.rowNum||i.frozenColumns)&&c(t([e[0],e[1]]),t([e[2],e[3]]),"height"),i.autoColWidth?h(e.filter("table:odd").find("tr:first-child td .cell"),"width",r.fieldElements):i.rowNum&&h(e.filter("table:odd").find("td .cell:first"),"width",r.fieldElements),(i.rowNum||i.frozenColumns)&&c(t([e[0],e[2]]),t([e[1],e[3]]),"width",r.fieldElements);var o="CSS1Compat"!==document.compatMode||/msie 6/i.test(navigator.userAgent)?"100%":"auto";a.css({width:o}),n.parent().css({width:o,overflow:"hidden"}),t(a).on("scroll",function(){n.parent().get(0).scrollLeft=this.scrollLeft,e.get(1).parentNode.scrollTop=this.scrollTop})}},f=function(t,e){var r,n=this.field;return t=t[n],e=e[n],this.order||(r=t,t=e,e=r),t==e?0:e>t?1:-1};return n.prototype={defaultOrder:!1,init:function(e,r){var n=window.document,a=this;this.columns=[],this.frozenColumns=[],this.userOptions=r,this.render=e;var o=t(e);if(o.addClass("datagrid-container cf"),r.pagination&&r.localData){e.innerHTML='<div class="datagrid-pagination"></div>';var d=t(".datagrid-pagination",e).get(0);r.pagination.renders=[d],r.pagination.dataSize=r.localData.length,pagination(r.pagination);var l=d.ui.iPagination.userOptions;r.data=r.localData.slice((l.pageNumber-1)*l.pageSize,l.pageNumber*l.pageSize)}if(t(s(r,a)).prependTo(e),this.fieldElements=t(".field .cell",e),u(t("table",e),a),5===n.documentMode||/MSIE 6/.test(navigator.userAgent)){t(".view",e).css({height:t(".head-wrapper").get(0).offsetHeight+t(".body-wrapper").get(0).offsetHeight}).eq(0).css({width:t(".view",e).eq(0).find("table").eq(0).width()}),t(".body-wrapper table, .body-wrapper table tr:first-child td",e).css({borderTop:"none"});var c={mouseenter:function(){this.style.backgroundColor="#e6e6e6"},mouseleave:function(){this.style.backgroundColor="transparent"}};o.delegate(".head td",c).delegate(".body tr",c)}!function(){var r=navigator.userAgent.match(/MSIE (\d*)/);r&&r[1]<9&&t(".view",e).eq(1).find("table, table td:first-child").css({borderLeft:"none"})}(),r.onCreate.bind(this)(),t(window).on("resize",function(){a.resize()}),t(window).resize(),setTimeout(function(){t(window).resize()},0);var h=[];if(i.apply(h,this.frozenColumns),i.apply(h,this.columns),this.allColumns=h,this.dataTbodys=t(".body tbody",e),r.data[0].tr&&r.data[0].frozenTr||r.data.forEach(function(t,e){r.frozenColumns.length&&(t.frozenTr=a.dataTbodys[0].rows[e]),t.tr=a.dataTbodys[1].rows[e]}),o.delegate(".field",{click:function(t){var e=a.fieldElements.index(this.children[0])-(r.rowNum?1:0);if(a.userOptions.rowNum&&-1===e)return!1;var n=a.allColumns[e].field;a.sortBy(n,a.sort!==n?a.defaultOrder:!a.order)}}),r.remoteSort||r.sort)if(r.remoteSort){var f=function(){for(var t in a.allColumns)if(r.sort.field===a.allColumns[t].field)return t+1}();t(".sort-mark",this.fieldElements[f]).html(light.ui.markChars["desc"==r.sort.order?"down":"up"])}else this.sortBy(r.sort.field,"desc"===r.sort.order)},sortBy:function(e,r){r=function(){return"desc"===r?!0:"asc"===r?!1:r===!0?!0:!1}();var n,i=this.userOptions,o=this.allColumns.filter(function(t,r){return t.field===e?(n=r+1,t):void 0});o=o[0];var d=this.fieldElements[n].parentNode;if(this.sort&&t(".sort-mark",this.sort.parentNode).html(a.empty),t(".sort-mark",d).html(r?a.down:a.up),this.sort===d.field&&d.order===r)return!1;this.order=d.order=r,this.sort===o.field&&d.order===!this.defaultOrder?(this.sort=d.field=e,i.data=i.data.reverse()):(this.sort=d.field=e,i.data.sort((o.sort||f).bind({field:e,order:r})));var s=document.createDocumentFragment(),l=document.createDocumentFragment(),c=null,h=null;i.data.forEach(function(t,e){var r=t.frozenTr,n=t.tr;r&&(c||function(){c=r.parentNode,c.style.display="none"}(),s.appendChild(r),i.rowNum&&(r.children[0].children[0].innerHTML=e+1)),n&&(h||function(){h=n.parentNode,h.style.display="none"}(),l.appendChild(n))}),(s.children||s.childNodes)&&c.appendChild(s),(l.children||l.childNodes)&&h.appendChild(l),c.style.display="",h.style.display="",s=null,l=null,c=null,h=null},resize:function(){var e=t(".view",this.render),r=t("table",e);r.eq(1).parent().css({height:r.get(3).parentNode.clientHeight}),e.eq(1).css({width:this.render.clientWidth-1-e.get(0).offsetWidth})}},n.prototype.init.prototype=n.prototype,this.each(function(){var r=t(this),a=n(this,t.extend(!0,{},e)),i=r.data("ui");i?i.iDatagrid=a:r.data("ui",{iDatagrid:a})})}}(jQuery);